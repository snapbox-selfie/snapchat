<!DOCTYPE html><html lang="en" class="bg-black text-white">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SnapBox Live</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@700&display=swap" rel="stylesheet" />
  <style>
    .popup-box, .msg-box, .challenge-box {
      background: white;
      color: black;
      padding: 2rem;
      border-radius: 1rem;
      width: 90%;
      max-width: 400px;
      text-align: center;
      font-weight: 600;
    }
    .blurred-socials {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      z-index: 40;
      filter: blur(2px);
    }
    .btn-glow, .btn-reset {
      background: #f0f002;
      color: black;
      padding: 0.5rem 1rem;
      border-radius: 1rem;
      font-weight: bold;
      box-shadow: 0 0 10px #f0f002;
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen px-4">  <!-- [All HTML Popups and Main Section from earlier remain unchanged] -->  <!-- Start of JavaScript -->  <script>
    function $(id) {
      return document.getElementById(id);
    }

    function show(id) {
      $(id).classList.remove("hidden");
    }

    function hide(id) {
      $(id).classList.add("hidden");
    }

    window.onload = function () {
      setTimeout(() => {
        hide("welcomePopup");
        show("namePopup");
      }, 2500);

      const currentLink = encodeURIComponent(window.location.href);
      $("shareWhatsApp").href = `https://wa.me/?text=Click%20your%20SnapBox%20selfie%20now!%20ðŸ‘»%20${currentLink}`;
      $("shareFacebook").href = `https://www.facebook.com/sharer/sharer.php?u=${currentLink}`;
      $("shareInstagram").href = `https://www.instagram.com/?url=${currentLink}`;
      $("shareTwitter").href = `https://twitter.com/intent/tweet?text=Click%20your%20SnapBox%20selfie%20now!%20ðŸ‘»%20${currentLink}`;
    };

    let userName = "";
    function submitName() {
      const name = $("userName").value.trim();
      const pass = $("userPass").value.trim();
      if (name === "" || pass === "") {
        alert("Please enter both name and password");
        return;
      }
      userName = name;
      hide("namePopup");
      $("sharedUser").innerText = userName;
      show("challengePopup");
    }

    let selfieCount = 0;
    let challengeTimer;
    function startChallenge() {
      hide("challengePopup");
      selfieCount = 0;
      challengeTimer = setTimeout(() => {
        if (selfieCount < 4) {
          show("failPopup");
        }
      }, 10000);
      askCameraPermission();
    }

    function askCameraPermission() {
      navigator.mediaDevices
        .getUserMedia({ video: true })
        .then((stream) => {
          $("camera").srcObject = stream;
          $("mainContainer").classList.remove("blur-md", "pointer-events-none");
        })
        .catch(() => {
          show("cameraDenyPopup");
        });
    }

    function retryChallenge() {
      hide("failPopup");
      resetAll();
      show("challengePopup");
    }

    function manualCapture() {
      if (selfieCount >= 4) return;
      const video = $("camera");
      const canvas = $("canvas");
      const ctx = canvas.getContext("2d");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);
      const dataURL = canvas.toDataURL("image/png");
      const box = document.querySelectorAll(".preview-box")[selfieCount];
      box.innerHTML = `<img src="${dataURL}" class="w-full h-full object-cover"/>`;
      selfieCount++;
      if (selfieCount === 4) {
        clearTimeout(challengeTimer);
        show("msg");
        setTimeout(() => {
          hide("msg");
        }, 3000);
      }
    }

    function resetAll() {
      document.querySelectorAll(".preview-box").forEach((box, i) => {
        box.innerHTML = `Tap ${i + 1}<div class="camera-icon"><i data-lucide="camera" class="w-4 h-4 text-purple-700"></i></div>`;
      });
      selfieCount = 0;
    }

    function toggleTheme() {
      document.documentElement.classList.toggle("bg-white");
      document.documentElement.classList.toggle("text-black");
      document.documentElement.classList.toggle("bg-black");
      document.documentElement.classList.toggle("text-white");
    }

    function downloadAllPhotos() {
      document.querySelectorAll(".preview-box img").forEach((img, i) => {
        const a = document.createElement("a");
        a.href = img.src;
        a.download = `selfie_${i + 1}.png`;
        a.click();
      });
    }

    window.addEventListener("DOMContentLoaded", () => {
      lucide.createIcons();
    });
  </script></body>
</html>
